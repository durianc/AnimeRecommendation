<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>动漫推荐系统 | Anime Recommendation System</title>

    <!-- 引入jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- 引入Bootstrap的CSS和JS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    
    <!-- Vue 3 CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <style>
        body {
            padding: 30px;
        }
    </style>
</head>
<body>
    <div id="app" class="container">
        <h1>动漫推荐系统 | Anime Recommendation System</h1>

        <!-- 用户ID输入 -->
        <div class="form-group">
            <label for="userId">用户ID | User ID:</label>
            <input v-model="userId" type="number" id="userId" class="form-control" placeholder="输入用户ID | Enter User ID">
        </div>
        <button @click="getRecommendations" class="btn btn-primary">获取推荐 | Get Recommendations</button>

        <h2 class="mt-5">推荐的动漫 | Recommended Anime:</h2>
        <ul class="list-group">
            <li v-for="anime in recommendations" :key="anime.id" class="list-group-item">{{ anime.title }}</li>
            <li v-if="recommendations.length === 0" class="list-group-item">没有推荐的动漫 | No recommended anime</li>
        </ul>

        <hr align="center" width="95%" color="#987cb9" size="1">

        <!-- 动漫ID输入 -->
        <div class="form-group mt-5">
            <label for="animeId">动漫ID | Anime ID:</label>
            <input v-model="animeId" type="number" id="animeId" class="form-control" placeholder="输入动漫ID | Enter Anime ID">
        </div>
        <button @click="getSimilarAnimes" class="btn btn-secondary">获取相似动漫 | Get Similar Anime</button>

        <h2 class="mt-5">相似的动漫 | Similar Anime:</h2>
        <ul class="list-group">
            <li v-for="anime in similarAnimes" :key="anime.id" class="list-group-item" @click="showAnimeDetails(anime)">
                {{ anime.name }}
            </li>
            <li v-if="similarAnimes.length === 0" class="list-group-item">没有相似的动漫 | No similar anime</li>
        </ul>

        <hr align="center" width="95%" color="#987cb9" size="1">

        <!-- 动漫详情ID输入 -->
        <div class="form-group mt-5">
            <label for="detailAnimeId">动漫详情ID | Anime Detail ID:</label>
            <input v-model="detailAnimeId" type="number" id="detailAnimeId" class="form-control" placeholder="输入动漫详情ID | Enter Anime Detail ID">
        </div>
        <button @click="getAnimeDetails(detailAnimeId)" class="btn btn-success">获取动漫详情 | Get Anime Details</button>

        <!-- 动漫详情 -->
        <h2 class="mt-5">动漫详情 | Anime Details:</h2>
        <div v-if="animeDetail" class="card">
            <img :src="animeDetail.image_url" v-if="animeDetail.image_url" class="card-img-top" alt="动漫图片 | Anime Image" style="width: 200px;">
            <div class="card-body">
                <h5 class="card-title">{{ animeDetail.name }}</h5>
                <p class="card-text" v-if="animeDetail.episodes">集数: {{ animeDetail.episodes }} | Episodes: {{ animeDetail.episodes }}</p>
                <p class="card-text" v-if="animeDetail.genre">类型: {{ animeDetail.genre }} | Genre: {{ animeDetail.genre }}</p>
                <p class="card-text" v-if="animeDetail.members">成员: {{ animeDetail.members }} | Members: {{ animeDetail.members }}</p>
                <p class="card-text" v-if="animeDetail.rating">评分: {{ animeDetail.rating }} | Rating: {{ animeDetail.rating }}</p>
                <p class="card-text" v-if="animeDetail.type">类型: {{ animeDetail.type }} | Type: {{ animeDetail.type }}</p>
                <p class="card-text" v-if="animeDetail.aired">播出时间: {{ animeDetail.aired }} | Aired: {{ animeDetail.aired }}</p>
            </div>
        </div>

        <!-- 模态框 -->
        <div class="modal fade" id="animeModal" tabindex="-1" role="dialog" aria-labelledby="animeModalLabel" aria-hidden="true">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="animeModalLabel">动漫详情 | Anime Details</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                <strong>名称 | Name:</strong> {{ selectedAnime.name }} <br>
                <strong>集数 | Episodes:</strong> {{ selectedAnime.episodes }} <br>
                <strong>类型 | Genre:</strong> {{ selectedAnime.genre }} <br>
                <strong>成员 | Members:</strong> {{ selectedAnime.members }} <br>
                <strong>评分 | Rating:</strong> {{ selectedAnime.rating }} <br>
                <strong>类型 | Type:</strong> {{ selectedAnime.type }}
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭 | Close</button>
              </div>
            </div>
          </div>
        </div>
    </div>

    <script>
        const app = Vue.createApp({
            data() {
                return {
                    userId: '',
                    animeId: '',
                    detailAnimeId: '',
                    recommendations: [],
                    similarAnimes: [],
                    animeDetail: null,
                    selectedAnime: {}
                };
            },
            methods: {
                // 获取推荐的动漫
                getRecommendations() {
                    fetch(`http://localhost:5003/recommends/${this.userId}`)
                        .then(response => response.json())
                        .then(data => {
                            this.recommendations = data;
                        })
                        .catch(error => {
                            console.error('获取推荐时出错 | Error fetching recommendations:', error);
                        });
                },
                // 获取相似动漫
                getSimilarAnimes() {
                    fetch(`http://localhost:5003/sim/${this.animeId}`)
                        .then(response => response.json())
                        .then(data => {
                            this.similarAnimes = data;
                        })
                        .catch(error => {
                            console.error('获取相似动漫时出错 | Error fetching similar anime:', error);
                        });
                },
                // 显示相似动漫详情的模态框
                showAnimeDetails(anime) {
                    this.selectedAnime = anime;
                    $('#animeModal').modal('show');
                },
                // 获取动漫详情
                getAnimeDetails(animeId) {
                    fetch(`http://localhost:5003/anime/${animeId}`)
                        .then(response => response.json())
                        .then(data => {
                            this.animeDetail = data;
                        })
                        .catch(error => {
                            console.error('获取动漫详情时出错 | Error fetching anime details:', error);
                            this.animeDetail = null;
                        });
                }
            }
        });

        app.mount('#app');
    </script>
</body>
</html>
